@model Restaurant
<head>
    <link rel="stylesheet" href="../css/menu.css" />
</head>

<body>

<div class="center-content">
    <h2>Menu for @Model.Name</h2>

    <div class="row">
        @foreach (var menuItem in Model.Menu)
        {
            <div class="col-md-4 mb-4">
                <div class="card">
                    <img src="@menuItem.ImageUrl" class="card-img-top" alt="@menuItem.ItemName">
                    <div class="card-body">
                        <button type="button" class="btn btn-details"
                            data-name="@menuItem.ItemName"
                            data-calories="@menuItem.Calories"
                            data-price="@menuItem.Price"
                            data-size="@menuItem.Size"
                            data-id="@menuItem.Id"
                            onclick="showItemDetails('@menuItem.Id')">Details</button>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Modal -->
    <div class="modal fade" id="itemDetailsModal" tabindex="-1" role="dialog" aria-labelledby="itemDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body" id="itemDetailsBody">

                </div>
                <div class="modal-footer">
                    <button id="addToCartBtn" class="btn btn-primary">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include jQuery and Bootstrap JavaScript -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var $ = jQuery.noConflict();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // JavaScript to handle the click event and populate modal content
    var name = "";
    var calories = 0;
    var price = 0.0;
    var size = "";
    var newPrice = 0.0;
    var newCal = 0;
    var cart = [];
    var menuItemId = 0;

    function showItemDetails(itemId) {
       $.ajax({
            url: '@Url.Action("GetItemDetails", "MenuItem")', // Replace with your controller action URL
            type: 'GET',
            data: { itemId: itemId },
            success: function (data) {
                // Populate modal content with fetched data
                $('#itemDetailsBody').html(data);
                $('#itemDetailsModal').modal('show');
            },
            error: function () {
                // Handle error if AJAX call fails
                alert('Failed to fetch item details.');
            }
        });
    }

    $(document).ready(function () {
    $('.btn-details').on('click', function () {
        name = $(this).data('name');
        calories = $(this).data('calories');
        newCal = calories;
        price = parseFloat($(this).data('price'));
        newPrice = price;
        size = $(this).data('size');
        menuItemId = $(this).data('id'); // Assign menuItemId here

        // Show the modal
        $('#itemDetailsModal').modal('show');

        console.log("Updated variables:");
        console.log("Name:", name);
        console.log("Calories:", newCal);
        console.log("Price:", newPrice);
        console.log("Size:", size);
        console.log("MenuItemId:", menuItemId);
    });

    $('#addToCartBtn').on('click', function () {
        console.log('Add to Cart button clicked.');

        var cartItem = {
            MenuItemId: menuItemId,
            MenuItemName: name,
            Price: newPrice,
            Size: size,
            Quantity: 1
        };

        console.log('CartItem:', cartItem);

        $.post('@Url.Action("AddToCart", "Cart")', cartItem, function (data) {
            console.log('Add to Cart request successful.');
            console.log('Response data:', data);
        }).fail(function (xhr, status, error) {
            console.error('Add to Cart request failed.');
            console.error('Error:', error);
            console.error('Status:', status);
            console.error('Response:', xhr.responseText);
        });

        console.log('Cart:', cart);

        $('#itemDetailsModal').modal('hide');
    });
});

    function changeSize(newSize) {
        var baseCal = calories;
        var medCal = baseCal * 1.2;
        var largeCal = baseCal * 1.4;
        var basePrice = price;
        var medPrice = basePrice * 1.2;
        var largePrice = basePrice * 1.4;
        if (newSize === 'small') {
            newPrice = basePrice;
            newCal = baseCal;
        } else if (newSize === 'medium') {
            newPrice = medPrice;
            newCal = medCal;
        } else if (newSize === 'large') {
            newPrice = largePrice;
            newCal = largeCal;
        }

        // Update current size
        size = newSize;

        // Update modal content dynamically
        updateModalContent();
    }

</script>
</body>
